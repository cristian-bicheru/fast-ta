#include <cstdlib>

#include "gtest/gtest.h"
#include "testing_common.h"

extern "C" {
    #include "volatility_backend.h"
}

const double ATR_REF_DOUBLE[data_len] = {
        2.809996999999981, 2.949997499999983, 2.855711249999983, 2.837446589285697,
        2.909772261479576, 2.804073742802464, 2.792354189745146, 2.818614890477637,
        2.767999541157804, 2.963142431075104, 3.797203685998312, 3.848831208427002,
        3.766057693539361, 4.086339286857978, 4.340886052082407, 4.287251048362236,
        4.426732402050648, 4.678394159047031, 5.367793647686527, 5.290807887137491,
        5.32217846662767, 5.201308933297121, 5.125501080918754, 5.382251075138844,
        5.348519141200354, 5.255767988257472, 5.235356060524795, 5.112830913344452,
        4.939056705248422, 4.825553083444965, 4.663727720341754, 4.567032740317344,
        4.787244258866105, 4.911726740375669, 4.943032401777407, 4.827102015936164,
        4.960880229083581, 4.979388855577611, 4.868003794464924, 4.704575094860288,
        4.596390230941696, 4.543076000160146, 4.417856928720136, 4.559438148097271,
        4.417335923233181, 4.297526643002241, 4.183418454216368, 4.026746136058056,
        4.02269298348248, 4.122500484662303, 3.970893307186424, 3.879401070958822,
        4.071587208747478, 3.907188408122658, 3.753103521828183, 3.640739555983314,
        3.79640044484165, 3.718085913067246, 3.630364847848157,  3.56248107300186,
        3.468732424930299,  3.40453668029242, 3.347784131700105, 3.238656122292956,
        3.188037756414888, 3.256034988099538, 3.354889631806713, 3.235969158106233,
        3.146256789670073, 3.100810518979354, 3.072894910480828, 3.060544845446483,
        3.045506356486018, 3.727255616737016, 4.267451215541516, 4.448346700145692,
        4.947750650135286, 4.932197817982765, 4.989897330983997, 4.954190807342282,
        4.896034321103547, 4.753461083881866, 5.246785506461732, 5.327729756000179,
        5.337891987714452, 5.343756774306275, 5.407059576141541, 5.237269534988574,
        5.098178353917961, 4.997594328638105, 5.459195233735383, 5.394252931325713,
        5.367520864802448, 5.155554660173702, 5.058015613018438, 4.928871640659978,
        4.899666809184265, 4.819690537099675, 4.816855427306842, 4.609223111070638,
        4.663563960279878, 4.692594534545601, 4.858124210649486, 4.765400838460237,
        4.858585921427364, 4.695115998468268, 4.481179998577678, 4.404667427250702,
        4.332191182447082, 4.386320169415148, 4.229440300171211, 4.305909064444696,
        4.309772774127219, 4.159074504546703, 4.124855468507652, 4.241651149328534,
        4.242247495805068, 4.414944317533279, 4.516019866280901, 4.669875447260837,
        4.628455558170776, 4.564279875444292, 4.480402670055415, 4.403945550765742,
        4.628663939996758, 4.545188444282706, 4.418388483976798,  4.25421859226417,
        4.1382022642453, 4.077617031084921, 4.113501600293142, 4.003965914557918,
        3.952253920660925,  3.88352185489943, 3.881126793835184, 3.794617594275528,
        4.036430123255847, 4.040256257309002, 4.602381024644073, 4.785782237169496,
        4.620369291657388, 4.423913985110433,  4.25934834331683, 4.177253175937059,
        4.135306234798697, 4.139213075170222, 3.977126141229493, 3.958045131141672,
        3.873898978917266, 3.821476480423173, 3.777084017535806, 3.693719801997534,
        3.850598030426282, 3.777699385395833, 3.675006357867562, 3.745363260877023,
        3.810694742242951,  3.80207383208274, 3.680497558362545, 3.760461161336648,
        4.053999292669745, 4.040141200336191, 4.047990043169323, 4.145991682942942,
        4.27056256273273, 4.266238236823248, 4.148649434193017, 4.226602403179233,
        4.236844731523571, 4.337071179271888, 4.239423309323898, 4.135178715800761,
        3.999093164672136,  4.00558622433841, 4.063044208314238, 3.913541193434652,
        4.041861251046461, 4.171014447400286, 4.406656344014549, 4.389038319442083,
        4.571965010910507, 4.536823724416901, 4.727764244101408, 4.634351298094165,
        4.823326062516009,  4.99594498662201, 4.954806987577579, 5.082322202750606,
        5.105013045411276, 5.165370113596186, 5.107844819767889, 5.010140904070181,
        4.867987196636598, 4.764558325448269, 4.703518730773394, 4.782552964289581,
        5.400227252554612, 5.689495448800709, 6.008817488172088, 5.978901667588366,
        6.66469340561777, 6.993643090930783, 7.278383655864299, 7.180642251873993,
        7.022024305311565, 7.035450497789311, 7.082917033661502, 6.947708888399966,
        6.995016539228542, 6.770372929283647, 6.510346648620529, 6.783895245147635,
        6.697188941922803, 6.678818517499745, 6.912475194821193, 8.120153895191107,
        8.711571045534599, 8.902173470853555, 9.672732722935443, 10.55610959986863,
        11.80781727130658,  12.2644026090704, 12.39408720842251, 12.31807997924948,
        12.27321726644594, 13.25584453312837, 13.75685485219063, 13.73708029131987,
        14.71514548479703, 15.92763630731153, 17.50209092821785,   17.624083790488,
        17.48950680545315, 16.97097024792078, 17.46090108735501, 17.40155129540108,
        17.82429813144386, 17.54756233634073, 17.23416424088782, 16.81672386653869,
        16.17124351892878, 15.76543969614815, 15.72219314642329, 15.18846506453591,
        14.58428870278335, 15.09255243829882, 14.92165669270605, 14.42296707179847,
        13.77632620952715, 13.35444755170379, 13.47198701229637, 12.96827243998949,
        12.4583818371331,
};

float ATR_REF_FLOAT[data_len] = {0};

const double BOLL_REF_DOUBLE[data_len] = {
        199.25,       205.0700075, 206.1263689400281, 206.7890458957986,
        208.9503973790833, 209.7355786847992, 209.5290785594242, 209.1865862611089,
        208.9400146656699, 208.8807830778649,  210.563225939522,  211.214804284695,
        212.491013319034, 212.6203861146837, 212.3473213366268, 212.0885647377763,
        211.9720588539521,  212.259511194742, 214.8978724226063, 215.6665584815065,
        216.2088718522978, 216.5770096828574, 216.8176920462158, 217.4908194830651,
        217.0265004931016, 216.7047773697228, 216.6432517899675, 216.4092694280416,
        215.857214539512, 215.5845090714811,  213.262262477819, 210.9842266541719,
        207.5585569351902, 203.8994301260733, 201.1720307795673,   198.05993330918,
        195.648859377, 194.5149116107019, 196.0070589377714, 196.9423130935653,
        197.5169440289457, 197.9307198567894, 198.6659757996613, 200.6375715687932,
        202.1387909112528, 203.9178568151773, 205.2965061230128, 206.3883623651321,
        206.7967528991208, 207.4934547596326, 207.9733519796615, 207.3484895411178,
        206.0494872237959, 205.6001715058952, 205.4881078953035, 205.3504118219252,
        205.113021318733, 205.1978787282057, 205.6947031665462,  205.811498960503,
        206.0372458352736, 206.2072070610278, 206.1799055129562, 206.3988653249795,
        206.9084454250815, 206.9938029871516, 207.7504240442849, 208.7274715798063,
        209.0045030987909, 209.3481437954204, 209.7145786203648, 210.0677222448392,
        210.518450524896, 211.9395475871995, 212.2394763030219, 212.2392498519717,
        213.5209142416857,  213.926603639351, 214.0852793460879, 214.0800781382017,
        214.1086310425518,  214.072339007878, 214.4782016336979, 214.4713799160848,
        214.3638237374381,  214.539805349144, 214.9410392638484, 215.1549143728708,
        215.7747941413953, 216.4837967133654, 216.2539937360489,  215.927749208245,
        215.5746635335907, 214.5385784558067, 214.6156132012247, 215.0074431129579,
        214.1538659999413, 213.9838156372253, 214.6038245095835, 215.4219996218168,
        216.0772836943071, 216.9924192194728, 219.9624169869916, 222.0656258170575,
        222.7206008011366, 223.7461072748026, 224.8257000477954, 226.1780065292153,
        227.0275104709401,  227.400769935838, 227.3390108375492, 227.3927485415266,
        227.3746670364839, 227.1214146970916, 227.0136874234048, 227.3748048161188,
        226.8690525201291, 225.9787881961066, 225.7356214512021, 226.4167401245932,
        226.9736687765721, 227.1492399784506, 227.7569848112211,  229.113552603562,
        232.1308551666681, 234.3963365848525, 236.1536388558012, 237.4701535087705,
        238.8005801039364, 239.9784971073705, 241.8303884366092, 243.1009812839615,
        245.0175875447921, 246.5619541973616, 248.2479401432853, 250.5306930911042,
        251.3891130512772,  251.313833816323, 252.0133156163956, 254.7108853682461,
        257.2408527089814, 258.7309399365392, 260.0310739460185, 261.6939244912742,
        263.628021659217, 265.6070833134344, 267.0920572958051, 268.5592069698627,
        269.314534684458, 270.3430373766009, 271.6778640576334, 272.3762066521045,
        272.6160434562721, 272.4699138651244, 272.4066081253895, 272.9780941826251,
        272.0198388181929, 270.6726764051764, 269.7598480680913, 269.5155590771276,
        269.339924461773, 269.0014524234936, 268.7830485437698, 269.8145843710872,
        269.9334679127043, 270.3860019044594, 271.2128119242035, 272.1191802455385,
        273.786016565376, 276.5310299830566,  278.845486137094,  280.662833014242,
        282.2545824608, 283.4138991315865, 285.2586104252042, 287.0628226276727,
        289.7740534445517, 292.1377002224818, 294.5004017342154, 296.7417605534102,
        299.4974336615944,  301.106755190332, 303.1083395787788, 304.8079876922287,
        306.6493662276455, 309.5399173115284,  312.103903719549, 315.6372736790244,
        317.7635254363308, 319.5343989245656, 321.6552076273255, 323.8844698766818,
        325.1234784894398, 325.8753328160394, 326.9017946341195,  327.202696364644,
        326.7063990608197, 326.7649977736311, 327.7420590496884, 328.3440438092266,
        327.9560243040668, 327.0327811090485, 326.7870413514138, 326.1278694525458,
        326.6038495117992,  326.777634301153, 327.0832445686249, 327.2632553645117,
        328.5939689618953, 329.1565061489928, 329.8243767806748, 329.8352651728648,
        330.2604871471836, 330.3511553547061, 330.4541310195445,  332.892393563987,
        336.7028977553036, 338.2932773136911, 342.2068449078081, 344.2220318956924,
        344.1216993853046, 344.4218874645928, 343.4753867866926, 342.2095880660516,
        340.2804787908999,  340.908838644499, 338.8295982052629, 337.2048099779537,
        336.8949947697569, 332.8100344919184, 331.4537931636928, 328.4270214771552,
        323.9053642344437, 319.0198087662189,  316.543019987328, 316.2275708066012,
        314.3751338777976,  311.483635991356, 310.6585468065429, 309.7451924474256,
        304.6801629371402, 301.0172345596087, 293.5186001807029, 287.3455074476956,
        281.1678351362042, 280.6577189358387, 275.2330461036673, 273.1562578533674,
        275.4673861240123, 274.2586409767661, 281.0323560054431, 285.8319708584933,
        290.6108834596582,
};

float BOLL_REF_FLOAT[data_len] = {0};

const double BOLM_REF_DOUBLE[data_len] = {
        199.25,       201.1900025,        202.080002,      202.69250125,
        203.6500002, 204.2350008333333, 204.3842862857143,     204.373750875,
        204.4000008888889,       204.0270006, 204.6172736363636, 204.9950003333333,
        205.5146156923077, 205.7264285714286,       205.5353334,    205.3706246875,
        205.0970585882353, 204.6572216111111, 203.6605257894737,       202.9104997,
        202.4939996,      201.84149945,       201.0984994,      200.02649925,
        198.98249975,       197.7634995,      196.48249975,      195.21599965,
        193.8969994,      192.73249975,       191.1214997,      189.41750035,
        187.4950005,      186.05300065,      185.03700025,       184.1530006,
        183.62450025,       183.3945007,      183.84900055,      184.12550045,
        184.28700025,       184.4200004,      184.66450035,       185.4325004,
        185.99599985,      186.83000025,           187.786,      188.76650005,
        189.6335006,       190.7545005,       191.8265006,      192.96900015,
        194.38150015,           195.536,      196.62950055,       197.5800003,
        198.0735008,      198.50650095,      198.92750085,      199.30550075,
        199.7630012,       200.3865013,      200.91700135, 201.1620017999999,
        201.5515022499999, 201.7080016999999, 202.1300017999999, 202.6430014999999,
        203.2980010499999,       203.6590011,       204.0590011,      204.64700085,
        205.0085006499999,       205.5240005, 205.7249999499999, 205.7145003499999,
        205.3804999499999, 205.1684996999999,      204.95899955, 205.0429991999999,
        204.9274992999999, 204.6909987499999, 204.9144987999999, 204.8844984999999,
        204.6884985499999, 204.8839987499999, 205.0404989999999, 205.1164992499999,
        205.3149992999999, 205.5869994499999, 205.3319991499999, 205.1724997499999,
        204.9414999999999, 204.5660002999999, 204.5950003999999, 204.8310004499999,
        205.4490004999999, 206.0585005999999, 206.7705008999999,        207.262001,
        207.92100065,       208.7320007,      209.46300045,      210.48000025,
        211.3305,       212.0004997,      212.51799925,       213.1384994,
        213.5544998,      213.81799925,      214.62199935,      215.18149875,
        216.0249985,       216.7429985,       217.2334991,       217.9949989,
        218.93949885, 219.4279990999999,       219.8049995,       220.4924995,
        221.1369994999999, 221.5219993499999,       221.6939995,       222.0439995,
        222.91699985, 223.7154998999999,       224.4465004,      225.02649995,
        225.74249955,      226.67649995, 227.7659996500001,      228.88000035,
        229.98750005,       231.1720002,      232.55999995,      233.81400005,
        234.7489999, 235.9639993000001, 237.3609987000001, 238.8014993000001,
        240.3234994000001, 241.9599999500001,       243.4704995, 244.9374993500001,
        246.1339997500001, 247.4505006000001,       248.7824998,       250.2875001,
        251.6555009,       253.1230012,      254.45250175,      255.76900185,
        256.7695023,       257.6910027, 258.4510025500001, 259.3170021500001,
        260.36700295,        261.596003,      262.52050325,       262.9375031,
        263.0350037,      263.26550295,       263.6825028,       264.2465027,
        264.5855026,      264.89950255,      265.34000245,      265.68950195,
        266.3150009,      267.01999965, 267.6854995500001, 268.3579986000001,
        269.1994979500001, 270.0709975500001,       271.1819976, 272.0769973000001,
        273.3579970500001, 274.4559966500001, 275.6694961000001, 277.1439956000001,
        279.1889953000001, 280.9734954500001,       282.6844955, 284.0684967000001,
        285.8819961500001, 287.9394958500001, 289.9174957500001, 292.1924957500001,
        294.0689957000001,      295.64299625,      297.38449555,       299.3339966,
        301.1614975,        303.074498,      304.83599855,        306.537999,
        307.4899993999999,       308.8845001, 310.5255004499999, 312.0365004999999,
        312.4945006999999,      313.05600125,      314.00850215,        315.161502,
        316.2625014499999,      316.78250115, 317.3435011999999,       317.4760009,
        318.20200185,       318.8785018,       319.3640029,      319.37750235,
        319.73000175,      319.86000055,       319.5509994,      318.54449915,
        317.5009979,       316.2489975,      313.70799715,      311.18249665,
        310.64749605,       309.6804962,       308.8749954,      307.44849545,
        305.6394958500001,      302.94649655,      301.13599695,      298.92699735,
        294.97849655,      292.63349685, 288.4964965999999,      285.18949665,
        281.3419967999999,      277.56599735,       273.3754982,       269.6849983,
        267.6249992,       265.2684997,      264.51450035,      263.23350135,
        261.0335013499999,      259.28200065,      256.19050135,      253.79100035,
        251.4100006,           251.225,      249.92949985,      249.46150055,
        250.44950025,       250.2135002,      252.45549925,      254.03399885,
        256.0284988499999,
};

float BOLM_REF_FLOAT[data_len] = {0};

const double BOLH_REF_DOUBLE[data_len] = {
        199.25,       197.3099975, 198.0336350599719, 198.5959566042014,
        198.3496030209167, 198.7344229818675, 199.2394940120044, 199.5609154888912,
        199.8599871121079, 199.1732181221351, 198.6713213332053, 198.7751963819716,
        198.5382180655814, 198.8324710281735, 198.7233454633732, 198.6526846372237,
        198.2220583225185, 197.0549320274802, 192.4231791563411, 190.1544409184935,
        188.7791273477021, 187.1059892171426, 185.3793067537842, 182.5621790169349,
        180.9384990068984, 178.8222216302773, 176.3217477100326, 174.0227298719584,
        171.936784260488,  169.880490428519,  168.980736922181, 167.8507740458281,
        167.4314440648099, 168.2065711739267, 168.9019697204328, 170.2460678908201,
        171.600141123, 172.2740897892982, 171.6909421622286, 171.3086878064347,
        171.0570564710544, 170.9092809432106, 170.6630249003387, 170.2274292312068,
        169.8532087887472, 169.7421436848227, 170.2754938769872,  171.144637734868,
        172.4702483008792, 174.0155462403674, 175.6796492203385, 178.5895107588822,
        182.7135130762041, 185.4718284941048, 187.7708932046966, 189.8095887780748,
        191.0339802812671, 191.8151231717943, 192.1602985334538,  192.799502539497,
        193.4887565647264, 194.5657955389721, 195.6540971870437, 195.9251382750203,
        196.1945590749184, 196.4222004128482, 196.5095795557149, 196.5585314201935,
        197.591499001209, 197.9698584045795, 198.4034235796351, 199.2262794551608,
        199.4985507751039, 199.1084534128005,  199.210523596978, 199.1897508480281,
        197.2400856583142, 196.4103957606489,  195.832719753912, 196.0059202617981,
        195.746367557448, 195.3096584921218, 195.3507959663019,  195.297617083915,
        195.0131733625617, 195.2281921508558, 195.1399587361514,  195.078084127129,
        194.8552044586044, 194.6902021866344, 194.4100045639509, 194.4172502917548,
        194.3083364664091, 194.5934221441931, 194.5743875987752, 194.6545577870419,
        196.7441350000585, 198.1331855627746, 198.9371772904164, 199.1020023781831,
        199.7647176056929, 200.4715821805272, 198.9635839130083, 198.8943746829424,
        199.9403991988634, 200.2548921251974, 200.2102984522047, 200.0989922707847,
        200.0814891290598, 200.2352285641621, 201.9049878624508, 202.9702489584734,
        204.675329963516, 206.3645823029084, 207.4533107765951, 208.6151929838812,
        211.0099451798708, 212.8772100038933, 213.8743775487978, 214.5682588754067,
        215.3003302234277, 215.8947587215492, 215.6310141887788, 214.9744463964379,
        213.7031445333318, 213.0346632151474, 212.7393619441987, 212.5828463912295,
        212.6844189960636, 213.3745027926295, 213.7016108633909, 214.6590194160385,
        214.9574125552079, 215.7820462026384, 216.8720597567146, 217.0973070088959,
        218.1088867487229, 220.6141647836771, 222.7086817836045, 222.8921132317541,
        223.4061460910188, 225.1890599634609, 226.9099250539817, 228.1810742087259,
        228.6399778407832, 229.2939178865657,  230.472942304195, 232.0157932301374,
        233.9964671155421, 235.9029650233992, 237.2271394423665, 239.1617970478955,
        240.9229611437279, 242.9120915348757, 244.4953969746107,  245.655910117375,
        248.7141670818072, 252.5193295948235, 255.2811584319086, 256.3594471228724,
        256.730082938227, 257.5295534765065, 258.5819570562302, 258.6784210289129,
        259.2375372872958, 259.4130031955405, 259.4671929757965, 259.2598236544615,
        258.8439852346241, 257.5089693169435, 256.5255129629061, 256.0531641857581,
        256.1444134392002, 256.7280959684136, 257.1053847747959, 257.0911719723274,
        256.9419406554485, 256.7742930775184, 256.8385904657848,   257.54623064659,
        258.8805569384058, 260.8402357096681, 262.2606514212212, 263.3290057077714,
        265.1146260723546, 266.3390743884717, 267.7310877804512, 268.7477178209758,
        270.3744659636693, 271.7515935754344, 273.1137834726745, 274.7835233233181,
        277.1995165105602, 280.2736631839606, 282.7702024658805, 285.8733016353559,
        288.2735997391802, 291.0040024263689, 293.3089418503115, 295.7289571907733,
        297.0329770959331, 299.0792213909514, 301.2299629485861, 304.1951345474541,
        305.9211533882007, 306.7873679988469,  307.603757831375, 307.6887464354883,
        307.8100347381047, 308.6004974510071, 308.9036290193252, 308.9197395271353,
        309.1995163528165, 309.3688457452939, 308.6478677804555,  304.196604736013,
        298.2990980446964, 294.2047176863089,  285.209149392192, 278.1429614043076,
        277.1732927146955, 274.9391049354072, 274.2746040133075, 272.6874028339484,
        270.9985129091002,  264.984154455501, 263.4423956947372, 260.6491847220464,
        253.0619983302431, 252.4569592080816, 245.5392000363071, 241.9519718228448,
        238.7786293655562,  236.112185933781,  230.207976412672, 223.1424257933988,
        220.8748645222024,  219.053363408644, 218.3704538934571, 216.7218102525744,
        217.3868397628597, 217.5467667403913, 218.8624025192971, 220.2364932523043,
        221.6521660637957, 221.7922810641612, 224.6259535963326, 225.7667432466325,
        225.4316143759877, 226.1683594232339, 223.8786424945568, 222.2360268415067,
        221.4461142403417,
};

float BOLH_REF_FLOAT[data_len] = {0};

TEST(momentum_backend, ATRDouble) {
    double* out = _ATR_DOUBLE(SAMPLE_HIGH_DOUBLE, SAMPLE_LOW_DOUBLE, SAMPLE_CLOSE_DOUBLE, data_len, 14);
    for (int i=0; i<data_len; i++) {
        ASSERT_DOUBLE_EQ(ATR_REF_DOUBLE[i], out[i]);
    }

    free(out);
}

TEST(momentum_backend, ATRFloat) {
    float* out = _ATR_FLOAT(SAMPLE_HIGH_FLOAT, SAMPLE_LOW_FLOAT, SAMPLE_CLOSE_FLOAT, data_len, 14);
    double max_fp_error = get_max_fp_error(ATR_REF_DOUBLE, data_len);
    for (int i=0; i<data_len; i++) {
        ASSERT_NEAR(ATR_REF_FLOAT[i], out[i], max_fp_error);
    }

    free(out);
}

TEST(momentum_backend, BOLDouble) {
    double** out = _BOL_DOUBLE(SAMPLE_CLOSE_DOUBLE, data_len, 20, 2);
    for (int i=0; i<data_len; i++) {
        ASSERT_DOUBLE_EQ(BOLL_REF_DOUBLE[i], out[0][i]);
        ASSERT_DOUBLE_EQ(BOLM_REF_DOUBLE[i], out[1][i]);
        ASSERT_DOUBLE_EQ(BOLH_REF_DOUBLE[i], out[2][i]);
    }
    free(out[0]);
    free(out[1]);
    free(out[2]);
    free(out);
}

TEST(momentum_backend, BOLFloat) {
    float** out = _BOL_FLOAT(SAMPLE_CLOSE_FLOAT, data_len, 20, 2);
    double max_fp_error1 = get_max_fp_error(BOLL_REF_DOUBLE, data_len);
    double max_fp_error2 = get_max_fp_error(BOLM_REF_DOUBLE, data_len);
    double max_fp_error3 = get_max_fp_error(BOLH_REF_DOUBLE, data_len);
    for (int i=0; i<data_len; i++) {
        ASSERT_NEAR(BOLL_REF_FLOAT[i], out[0][i], max_fp_error1);
        ASSERT_NEAR(BOLM_REF_FLOAT[i], out[1][i], max_fp_error2);
        ASSERT_NEAR(BOLH_REF_FLOAT[i], out[2][i], max_fp_error3);
    }

    free(out[0]);
    free(out[1]);
    free(out[2]);
    free(out);
}

int main(int argc, char* argv[]) {
    populate_float_arrays();
    for (int i=0; i<data_len; i++) {
        ATR_REF_FLOAT[i] = (float)ATR_REF_DOUBLE[i];
    }
    for (int i=0; i<data_len; i++) {
        BOLL_REF_FLOAT[i] = (float)BOLL_REF_DOUBLE[i];
    }
    for (int i=0; i<data_len; i++) {
        BOLM_REF_FLOAT[i] = (float)BOLM_REF_DOUBLE[i];
    }
    for (int i=0; i<data_len; i++) {
        BOLH_REF_FLOAT[i] = (float)BOLH_REF_DOUBLE[i];
    }
    testing::InitGoogleTest(&argc, argv);
    return RUN_ALL_TESTS();
}